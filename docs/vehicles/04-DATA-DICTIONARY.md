# 04 — Data Dictionary

**Module:** Vehicle  
**Version:** 1.0  
**Last Updated:** December 2024

---

## Overview

This document provides detailed definitions for every field in the Vehicle module database schema. Use this as the authoritative reference for data types, constraints, and validation rules.

---

## 1. Enumeration Types

### 1.1 vehicle_type

**Description:** Type of vehicle supported by the system.

| Value | Display (PT-BR) | Description |
|-------|-----------------|-------------|
| `CARRO` | Carro | Automobile (car) |
| `MOTO` | Moto | Motorcycle |

**Future Values (v2+):**
- `CAMINHAO` — Truck
- `ONIBUS` — Bus
- `VAN` — Van/Utility

---

### 1.2 vehicle_status

**Description:** Current lifecycle state of a user's vehicle.

| Value | Display (PT-BR) | Description |
|-------|-----------------|-------------|
| `ACTIVE` | Ativo | Normal state, receives reminders |
| `SOLD` | Vendido | Sold, no reminders, history preserved |
| `DELETED` | Excluído | Soft deleted, invisible to user |

**State Transitions:**
```
ACTIVE ──► SOLD ──► DELETED
   │                   ▲
   └───────────────────┘
```

---

### 1.3 brazilian_state

**Description:** Brazilian states (Unidades Federativas).

| Value | Name |
|-------|------|
| `AC` | Acre |
| `AL` | Alagoas |
| `AP` | Amapá |
| `AM` | Amazonas |
| `BA` | Bahia |
| `CE` | Ceará |
| `DF` | Distrito Federal |
| `ES` | Espírito Santo |
| `GO` | Goiás |
| `MA` | Maranhão |
| `MT` | Mato Grosso |
| `MS` | Mato Grosso do Sul |
| `MG` | Minas Gerais |
| `PA` | Pará |
| `PB` | Paraíba |
| `PR` | Paraná |
| `PE` | Pernambuco |
| `PI` | Piauí |
| `RJ` | Rio de Janeiro |
| `RN` | Rio Grande do Norte |
| `RS` | Rio Grande do Sul |
| `RO` | Rondônia |
| `RR` | Roraima |
| `SC` | Santa Catarina |
| `SP` | São Paulo |
| `SE` | Sergipe |
| `TO` | Tocantins |

---

### 1.4 fuel_type

**Description:** Vehicle fuel type.

| Value | Display (PT-BR) |
|-------|-----------------|
| `GASOLINA` | Gasolina |
| `ETANOL` | Etanol |
| `FLEX` | Flex |
| `DIESEL` | Diesel |
| `ELETRICO` | Elétrico |
| `HIBRIDO` | Híbrido |

---

### 1.5 transmission_type

**Description:** Vehicle transmission type.

| Value | Display (PT-BR) |
|-------|-----------------|
| `MANUAL` | Manual |
| `AUTOMATICO` | Automático |
| `CVT` | CVT |

---

### 1.6 catalog_source

**Description:** Origin of catalog data.

| Value | Description |
|-------|-------------|
| `AI` | Generated by AI (needs review) |
| `MANUAL` | Entered manually by user |
| `VERIFIED` | Verified by admin/system |

---

### 1.7 maintenance_type

**Description:** Types of maintenance items.

| Value | Display (PT-BR) | Description |
|-------|-----------------|-------------|
| `OLEO` | Óleo do motor | Engine oil change |
| `FILTRO_OLEO` | Filtro de óleo | Oil filter |
| `FILTRO_AR` | Filtro de ar | Air filter |
| `FILTRO_AC` | Filtro do ar-condicionado | A/C cabin filter |
| `CORREIA_DENTADA` | Correia dentada | Timing belt |
| `CORREIA_ALTERNADOR` | Correia do alternador | Alternator belt |
| `VELAS` | Velas de ignição | Spark plugs |
| `PASTILHA_FREIO` | Pastilhas de freio | Brake pads |
| `DISCO_FREIO` | Discos de freio | Brake discs |
| `FLUIDO_FREIO` | Fluido de freio | Brake fluid |
| `FLUIDO_ARREFECIMENTO` | Fluido de arrefecimento | Coolant |
| `SUSPENSAO` | Suspensão | Suspension components |
| `BATERIA` | Bateria | Battery |
| `PNEUS` | Pneus | Tires |
| `ALINHAMENTO` | Alinhamento | Wheel alignment |
| `BALANCEAMENTO` | Balanceamento | Wheel balancing |
| `OUTROS` | Outros | Other/custom |

---

## 2. Table: vehicle_brands

**Description:** Master list of vehicle manufacturers.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `name` | VARCHAR(100) | No | — | Brand name (e.g., "Honda") |
| `type` | vehicle_type | No | — | CARRO or MOTO |
| `logo_url` | VARCHAR(500) | Yes | NULL | URL to brand logo image |
| `verified` | BOOLEAN | No | false | Admin-verified brand |
| `created_by` | UUID | Yes | NULL | FK to users.id (if user-added) |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |

**Constraints:**
- PK: `id`
- UNIQUE: `name` (case-insensitive)
- FK: `created_by` → `users.id` ON DELETE SET NULL

**Validation Rules:**
| Field | Rule |
|-------|------|
| name | 2-100 characters, alphanumeric + space + hyphen |
| logo_url | Valid URL format or NULL |

---

## 3. Table: vehicle_models

**Description:** Vehicle models within each brand.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `brand_id` | UUID | No | — | FK to vehicle_brands.id |
| `name` | VARCHAR(100) | No | — | Model name (e.g., "Civic") |
| `type` | vehicle_type | No | — | CARRO or MOTO |
| `verified` | BOOLEAN | No | false | Admin-verified model |
| `created_by` | UUID | Yes | NULL | FK to users.id (if user-added) |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |

**Constraints:**
- PK: `id`
- FK: `brand_id` → `vehicle_brands.id` ON DELETE RESTRICT
- UNIQUE: (`brand_id`, `name`)

**Validation Rules:**
| Field | Rule |
|-------|------|
| name | 2-100 characters |
| type | Must match brand's type (usually) |

---

## 4. Table: vehicle_catalogs

**Description:** Specific vehicle configurations (brand + model + year).

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `model_id` | UUID | No | — | FK to vehicle_models.id |
| `year` | INTEGER | No | — | Model year (1950-current+1) |
| `version` | VARCHAR(100) | Yes | NULL | Trim level (e.g., "LX", "1.5 Turbo") |
| `engine` | VARCHAR(50) | Yes | NULL | Engine specification |
| `fuel` | fuel_type | Yes | NULL | Fuel type |
| `transmission` | transmission_type | Yes | NULL | Transmission type |
| `source` | catalog_source | No | 'MANUAL' | How this entry was created |
| `created_by` | UUID | Yes | NULL | FK to users.id or NULL for AI |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |

**Constraints:**
- PK: `id`
- FK: `model_id` → `vehicle_models.id` ON DELETE RESTRICT
- UNIQUE: (`model_id`, `year`)

**Validation Rules:**
| Field | Rule |
|-------|------|
| year | 1950 ≤ year ≤ CURRENT_YEAR + 1 |
| version | 0-100 characters |
| engine | 0-50 characters |

---

## 5. Table: maintenance_templates

**Description:** Default maintenance intervals for each catalog entry.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `catalog_id` | UUID | No | — | FK to vehicle_catalogs.id |
| `type` | maintenance_type | No | — | Type of maintenance |
| `interval_km` | INTEGER | Yes | NULL | KM interval (e.g., 10000) |
| `interval_months` | INTEGER | Yes | NULL | Month interval (e.g., 12) |
| `description` | VARCHAR(200) | No | — | Display description |
| `notes` | TEXT | Yes | NULL | Additional notes |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |

**Constraints:**
- PK: `id`
- FK: `catalog_id` → `vehicle_catalogs.id` ON DELETE CASCADE
- UNIQUE: (`catalog_id`, `type`)
- CHECK: `interval_km > 0` OR `interval_km IS NULL`
- CHECK: `interval_months > 0` OR `interval_months IS NULL`
- CHECK: NOT (`interval_km IS NULL` AND `interval_months IS NULL`)

**Validation Rules:**
| Field | Rule |
|-------|------|
| interval_km | 1-999999 or NULL |
| interval_months | 1-120 or NULL |
| description | 1-200 characters |

---

## 6. Table: user_vehicles

**Description:** Vehicles registered by users.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `user_id` | UUID | No | — | FK to users.id |
| `catalog_id` | UUID | Yes | NULL | FK to vehicle_catalogs.id |
| `placa` | VARCHAR(7) | No | — | License plate (normalized) |
| `type` | vehicle_type | No | — | CARRO or MOTO |
| `status` | vehicle_status | No | 'ACTIVE' | Current status |
| `estado` | brazilian_state | No | — | Brazilian state (for IPVA) |
| `apelido` | VARCHAR(50) | Yes | NULL | User nickname |
| `cor` | VARCHAR(30) | Yes | NULL | Vehicle color |
| `renavam` | VARCHAR(11) | Yes | NULL | Renavam number |
| `ano` | INTEGER | No | — | Vehicle year |
| `km_atual` | INTEGER | Yes | NULL | Current odometer reading |
| `photo_url` | VARCHAR(500) | Yes | NULL | S3 URL to photo |
| `sold_at` | TIMESTAMP | Yes | NULL | When marked as sold |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |
| `deleted_at` | TIMESTAMP | Yes | NULL | Soft delete timestamp |

**Constraints:**
- PK: `id`
- FK: `user_id` → `users.id` ON DELETE CASCADE
- FK: `catalog_id` → `vehicle_catalogs.id` ON DELETE SET NULL
- UNIQUE: `placa` (global uniqueness)
- CHECK: `ano >= 1950 AND ano <= EXTRACT(YEAR FROM CURRENT_DATE) + 1`
- CHECK: `km_atual >= 0` OR `km_atual IS NULL`

**Validation Rules:**
| Field | Rule |
|-------|------|
| placa | 7 chars, format `^[A-Z]{3}[0-9][A-Z0-9][0-9]{2}$` |
| apelido | 0-50 characters, emoji allowed |
| cor | 0-30 characters |
| renavam | 9-11 digits |
| ano | 1950 to current year + 1 |
| km_atual | 0 to 9,999,999 |
| photo_url | Valid URL or NULL |

**Placa Normalization:**
```
Input: "ABC-1D23" → Stored: "ABC1D23"
Input: "abc1d23" → Stored: "ABC1D23"
Input: "ABC 1234" → Stored: "ABC1234"
```

---

## 7. Table: user_maintenance_overrides

**Description:** User-specific overrides to catalog maintenance intervals.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `user_vehicle_id` | UUID | No | — | FK to user_vehicles.id |
| `maintenance_type` | maintenance_type | No | — | Which maintenance |
| `custom_interval_km` | INTEGER | Yes | NULL | Custom KM interval |
| `custom_interval_months` | INTEGER | Yes | NULL | Custom month interval |
| `created_at` | TIMESTAMP | No | NOW() | Creation timestamp |
| `updated_at` | TIMESTAMP | No | NOW() | Last update timestamp |

**Constraints:**
- PK: `id`
- FK: `user_vehicle_id` → `user_vehicles.id` ON DELETE CASCADE
- UNIQUE: (`user_vehicle_id`, `maintenance_type`)
- CHECK: `custom_interval_km > 0` OR `custom_interval_km IS NULL`
- CHECK: `custom_interval_months > 0` OR `custom_interval_months IS NULL`

**Usage Logic:**
```
GET maintenance interval for vehicle:
1. Check user_maintenance_overrides for this vehicle + type
2. If override exists → use override values
3. Else if vehicle has catalog_id → use maintenance_template values
4. Else → no default (user must set manually)
```

---

## 8. Table: maintenance_history

**Description:** Historical record of completed maintenance.

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | UUID | No | uuid_generate_v4() | Primary key |
| `user_vehicle_id` | UUID | No | — | FK to user_vehicles.id |
| `reminder_id` | UUID | Yes | NULL | FK to reminders.id (if from reminder) |
| `maintenance_type` | maintenance_type | No | — | Type of maintenance |
| `completed_at` | DATE | No | — | Completion date |
| `km_at_completion` | INTEGER | Yes | NULL | Odometer at completion |
| `cost` | DECIMAL(10,2) | Yes | NULL | Cost in BRL |
| `notes` | TEXT | Yes | NULL | User notes |
| `service_provider` | VARCHAR(200) | Yes | NULL | Where service was done |
| `created_at` | TIMESTAMP | No | NOW() | Record creation time |

**Constraints:**
- PK: `id`
- FK: `user_vehicle_id` → `user_vehicles.id` ON DELETE CASCADE
- FK: `reminder_id` → `reminders.id` ON DELETE SET NULL
- CHECK: `km_at_completion >= 0` OR `km_at_completion IS NULL`
- CHECK: `cost >= 0` OR `cost IS NULL`

**Validation Rules:**
| Field | Rule |
|-------|------|
| completed_at | Cannot be future date |
| km_at_completion | 0 to 9,999,999 |
| cost | 0.00 to 9,999,999.99 |
| notes | 0-2000 characters |
| service_provider | 0-200 characters |

---

## 9. Field Reference Quick Guide

### Required Fields for Vehicle Creation

| Field | Display Label (PT-BR) |
|-------|----------------------|
| placa | Placa |
| type | Tipo |
| estado | Estado |
| brand_id | Marca |
| model_id | Modelo |
| ano | Ano |

### Optional Fields for Vehicle Creation

| Field | Display Label (PT-BR) |
|-------|----------------------|
| apelido | Apelido |
| cor | Cor |
| renavam | Renavam |
| km_atual | Quilometragem atual |
| photo | Foto |

---

## 10. Data Type Reference

| PostgreSQL Type | TypeScript Type | JSON Type |
|-----------------|-----------------|-----------|
| UUID | string | string |
| VARCHAR(n) | string | string |
| TEXT | string | string |
| INTEGER | number | number |
| DECIMAL(p,s) | number | number |
| BOOLEAN | boolean | boolean |
| TIMESTAMP | Date | string (ISO 8601) |
| DATE | Date | string (YYYY-MM-DD) |
| ENUM | string (union type) | string |

---

**Next:** [05-API-SPEC.md](./05-API-SPEC.md) — API Specification
